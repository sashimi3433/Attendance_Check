{% extends "form-base.html" %}
{% load static %}

{% block title %}出席確認エラー{% endblock title %}

{% block content %}
<div class="form-container">
    <div class="form-card checkin-error">
        <div class="icon-section">
            <i class="fas fa-times-circle error-icon"></i>
        </div>
        
        <div class="message-section">
            <h2 class="error-title">出席確認エラー</h2>
            <p class="error-message">出席確認に失敗しました</p>
            <div class="error-details" id="errorDetails">
                エラーの詳細を読み込み中...
            </div>
        </div>
        
        <div class="progress-section">
            <p class="redirect-text"><span class="countdown" id="countdown">7</span>秒後にQRコード読み取り画面に戻ります...</p>
            <div class="progress-bar">
                <div id="countdown-progress" class="progress-fill"></div>
            </div>
        </div>
        
        <div class="action-section">
            <a href="/attendance_token/qr-scanner/" class="btn btn-primary">
                <i class="fas fa-redo"></i>
                今すぐ再試行
            </a>
        </div>
    </div>
</div>

<script>
// 7秒後に自動リダイレクト
let countdown = 7;
const progressBar = document.getElementById('countdown-progress');
const countdownElement = document.getElementById('countdown');

// エラーメッセージを表示
function displayErrorMessage() {
    const errorMessage = sessionStorage.getItem('errorMessage');
    const errorDetails = document.getElementById('errorDetails');
    
    if (errorMessage) {
        errorDetails.textContent = errorMessage;
        sessionStorage.removeItem('errorMessage');
    } else {
        errorDetails.textContent = '不明なエラーが発生しました。もう一度お試しください。';
    }
}

const timer = setInterval(() => {
    countdown--;
    const progress = (countdown / 7) * 100;
    progressBar.style.width = progress + '%';
    countdownElement.textContent = countdown;
    
    if (countdown <= 0) {
        clearInterval(timer);
        window.location.href = '/attendance_token/qr-scanner/';
    }
}, 1000);

// ページ読み込み時に実行
window.addEventListener('load', () => {
    displayErrorMessage();
});
</script>
{% endblock content %}